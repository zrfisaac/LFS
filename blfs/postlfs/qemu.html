<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      qemu-9.0.2
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-12.2">
    <div class="navheader">
      <h4>
        Beyond Linux<sup>®</sup> From Scratch <span class="phrase">(System
        V</span> Edition) - Version 12.2
      </h4>
      <h3>
        Chapter&nbsp;8.&nbsp;Virtualization
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="virtualization.html" title=
          "Virtualization">Prev</a>
          <p>
            Virtualization
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../general/general.html" title=
          "General Libraries and Utilities">Next</a>
          <p>
            General Libraries and Utilities
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="virtualization.html" title=
          "Chapter&nbsp;8.&nbsp;Virtualization">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.2">Home</a>
        </li>
      </ul>
    </div>
    <h1 class="sect1">
      <a id="qemu" name="qemu"></a>qemu-9.0.2
    </h1>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="package" lang="en" xml:lang="en">
        <h2 class="sect2">
          Introduction to qemu
        </h2>
        <p>
          <span class="application">qemu</span> is a full virtualization
          solution for Linux on x86 hardware containing virtualization
          extensions (Intel VT or AMD-V).
        </p>
        <p>
          This package is known to build and work properly using an LFS 12.2
          platform.
        </p>
        <h3>
          Package Information
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Download (HTTP): <a class="ulink" href=
                "https://download.qemu.org/qemu-9.0.2.tar.xz">https://download.qemu.org/qemu-9.0.2.tar.xz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Download MD5 sum: f7f0462262d2571f146c6a8adda33b29
              </p>
            </li>
            <li class="listitem">
              <p>
                Download size: 126 MB
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated disk space required: 2.2 GB (374 MB installed)
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated build time: 1.6 SBU (add 1.0 SBU for tests, both
                using parallelism=4)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Qemu Dependencies
        </h3>
        <h4>
          Required
        </h4>
        <p class="required">
          <a class="xref" href="../general/glib2.html" title=
          "GLib-2.80.4">GLib-2.80.4</a> and <a class="xref" href=
          "../general/pixman.html" title="Pixman-0.43.4">Pixman-0.43.4</a>
        </p>
        <h4>
          Recommended
        </h4>
        <p class="recommended">
          <a class="xref" href="../multimedia/alsa-lib.html" title=
          "alsa-lib-1.2.12">alsa-lib-1.2.12</a>, <a class="xref" href=
          "../general/dtc.html" title="dtc-1.7.1">dtc-1.7.1</a>, <a class=
          "xref" href="../basicnet/libslirp.html" title=
          "libslirp-4.8.0">libslirp-4.8.0</a>, and <a class="xref" href=
          "../multimedia/sdl2.html" title="SDL2-2.30.6">SDL2-2.30.6</a>
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            If <a class="xref" href="../general/dtc.html" title=
            "dtc-1.7.1">dtc-1.7.1</a> is not installed, the building system
            will attempt to download a copy of dtc source code from the
            Internet.
          </p>
        </div>
        <h4>
          Optional
        </h4>
        <p class="optional">
          <a class="xref" href="../multimedia/pipewire.html" title=
          "Pipewire-1.2.3">pipewire-1.2.3</a> or <a class="xref" href=
          "../multimedia/pulseaudio.html" title=
          "PulseAudio-17.0">PulseAudio-17.0</a> (can be used instead of
          alsa-lib), <a class="xref" href="../general/bluez.html" title=
          "BlueZ-5.77">BlueZ-5.77</a>, <a class="xref" href=
          "../basicnet/curl.html" title="cURL-8.9.1">cURL-8.9.1</a>,
          <a class="xref" href="cyrus-sasl.html" title=
          "Cyrus SASL-2.1.28">Cyrus SASL-2.1.28</a>, <a class="xref" href=
          "fuse.html" title="Fuse-3.16.2">Fuse-3.16.2</a>, <a class="xref"
          href="gnutls.html" title="GnuTLS-3.8.7.1">GnuTLS-3.8.7.1</a>,
          <a class="xref" href="../x/gtk3.html" title=
          "GTK+-3.24.43">GTK+-3.24.43</a>, <a class="xref" href=
          "../general/keyutils.html" title=
          "keyutils-1.6.3">keyutils-1.6.3</a>, <a class="xref" href=
          "../general/libaio.html" title="libaio-0.3.113">libaio-0.3.113</a>,
          <a class="xref" href="../general/libusb.html" title=
          "libusb-1.0.27">libusb-1.0.27</a>, <a class="xref" href=
          "../general/libgcrypt.html" title=
          "libgcrypt-1.11.0">libgcrypt-1.11.0</a>, <a class="xref" href=
          "../general/libjpeg.html" title=
          "libjpeg-turbo-3.0.1">libjpeg-turbo-3.0.1</a>, <a class="xref"
          href="../general/libseccomp.html" title=
          "libseccomp-2.5.5">libseccomp-2.5.5</a>, <a class="xref" href=
          "../general/libssh2.html" title=
          "libssh2-1.11.0">libssh2-1.11.0</a>, <a class="xref" href=
          "../general/libpng.html" title="libpng-1.6.43">libpng-1.6.43</a>,
          <a class="xref" href="../general/libtasn1.html" title=
          "libtasn1-4.19.0">libtasn1-4.19.0</a>, <a class="xref" href=
          "linux-pam.html" title="Linux-PAM-1.6.1">Linux-PAM-1.6.1</a>,
          <a class="xref" href="../general/lzo.html" title=
          "LZO-2.10">LZO-2.10</a>, <a class="xref" href="nettle.html" title=
          "Nettle-3.10">Nettle-3.10</a>, <a class="xref" href=
          "../x/mesa.html" title="Mesa-24.1.5">Mesa-24.1.5</a>, <a class=
          "xref" href="../gnome/vte.html" title="VTE-0.76.4">VTE-0.76.4</a>,
          <a class="ulink" href=
          "https://www.capstone-engine.org/">capstone</a>, <a class="ulink"
          href="https://github.com/ceph/ceph/">ceph</a>, <a class="ulink"
          href="https://pmem.io/daxctl/">daxctl</a>, <a class="ulink" href=
          "https://jackaudio.org/">JACK</a>, <a class="ulink" href=
          "https://github.com/gluster/glusterfs">glusterfs</a>, <a class=
          "ulink" href="https://github.com/libbpf/libbpf">libbpf</a>,
          <a class="ulink" href=
          "https://gitlab.freedesktop.org/spice/libcacard">libcacard</a>,
          <a class="ulink" href=
          "https://people.redhat.com/sgrubb/libcap-ng/">libcap-ng</a>,
          <a class="ulink" href="https://sourceware.org/elfutils/">libdw</a>,
          <a class="ulink" href=
          "https://github.com/sahlberg/libiscsi">libiscsi</a>, <a class=
          "ulink" href="https://github.com/sahlberg/libnfs">libnfs</a>,
          <a class="ulink" href="https://pmem.io/pmdk/libpmem/">libpmem</a>,
          <a class="ulink" href="https://www.libssh.org/">libssh</a>,
          <a class="ulink" href=
          "https://github.com/Agnoctopus/libu2f-emu">libu2f-emu</a>,
          <a class="ulink" href="https://github.com/lzfse/lzfse">lzfse</a>,
          <a class="ulink" href=
          "https://github.com/luigirizzo/netmap">netmap</a>, <a class="ulink"
          href="https://github.com/numactl/numactl">numactl</a>, <a class=
          "ulink" href=
          "https://github.com/linux-rdma/rdma-core">rdma-core</a>, <a class=
          "ulink" href="https://selinuxproject.org/">SELinux</a>, <a class=
          "ulink" href="https://google.github.io/snappy/">snappy</a>,
          <a class="ulink" href=
          "https://gitlab.freedesktop.org/spice/spice">spice</a>, <a class=
          "ulink" href=
          "https://gitlab.freedesktop.org/spice/usbredir">usbredir</a>, and
          <a class="ulink" href=
          "https://github.com/virtualsquare/vde-2">VDE</a>
        </p>
        <h4>
          Optional (Runtime)
        </h4>
        <p class="runtime">
          <span class="phrase"><a class="xref" href="../general/elogind.html"
          title="elogind-255.5">elogind-255.5</a></span>
        </p>
        <h4>
          Optional (for building the documentation)
        </h4>
        <p class="optional">
          <a class="xref" href=
          "../general/python-modules.html#sphinx_rtd_theme" title=
          "Sphinx_rtd_theme-2.0.0">sphinx_rtd_theme-2.0.0</a>
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            This optional dependencies list is not comprehensive. See the
            output of <span class="command"><strong>./configure
            --help</strong></span> for a more complete list.
          </p>
        </div>
        <p class="usernotes">
          Editor Notes: <a class="ulink" href=
          "https://wiki.linuxfromscratch.org/blfs/wiki/qemu">https://wiki.linuxfromscratch.org/blfs/wiki/qemu</a>
        </p>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <h2 class="sect2">
          <a id="qemu-prereq" name="qemu-prereq"></a>KVM Prerequisites
        </h2>
        <p>
          Before building <span class="application">qemu</span>, check to see
          if your processor supports Virtualization Technology (VT):
        </p>
        <pre class="userinput"><kbd class=
        "command">grep -E '^flags.*(vmx|svm)' /proc/cpuinfo</kbd></pre>
        <p>
          If you get any output, you have VT technology (vmx for Intel
          processors and svm for AMD processors). You then need to go into
          your system BIOS and ensure it is enabled. After enabling, reboot
          back to your LFS instance.
        </p>
      </div>
      <div class="kernel" lang="en" xml:lang="en">
        <h2 class="sect2">
          <a id="qemu-kernel" name="qemu-kernel"></a>Kernel Configuration
        </h2>
        <p>
          Enable the following options in the kernel configuration and
          recompile the kernel if necessary:
        </p>
        <pre class="screen">[*] <span class=
        "blue">V</span>irtualization ---&gt;                                         [VIRTUALIZATION]
  &lt;*/M&gt;   <span class=
"blue">K</span>ernel-based Virtual Machine (KVM) support                       [KVM]
  # Enable the option for your CPU:
  &lt; /*/M&gt;   <span class=
"blue">K</span>VM for Intel (and compatible) processors support        [KVM_INTEL]
  &lt; /*/M&gt;   <span class=
"blue">K</span>VM for AMD processors support                             [KVM_AMD]</pre>
        <p>
          The Intel or AMD settings are not both required, but the one
          matching your system processor is required.
        </p>
        <p>
          To use the <span class="quote">“<span class=
          "quote">bridge</span>”</span> network device, as explained below,
          check that <a class="xref" href="../basicnet/bridge-utils.html"
          title="bridge-utils-1.7.1">bridge-utils-1.7.1</a> is installed and
          the following options in the kernel configuration are enabled:
        </p>
        <pre class="screen">[*] N<span class=
        "blue">e</span>tworking support ---&gt;                                                [NET]
  N<span class="blue">e</span>tworking options ---&gt;
    &lt;*/M&gt; 802.1<span class=
"blue">d</span> Ethernet Bridging                                      [BRIDGE]

<span class="blue">D</span>evice Drivers ---&gt;
  [*] N<span class=
"blue">e</span>twork device support ---&gt;                                   [NETDEVICES]
    [*]   N<span class=
"blue">e</span>twork core driver support                                 [NET_CORE]
    &lt;*/M&gt;   <span class=
"blue">U</span>niversal TUN/TAP device driver support                        [TUN]</pre>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <h2 class="sect2">
          Installation of qemu
        </h2>
        <p>
          The udev rule of LFS only allows the <code class=
          "systemitem">root</code> user, the users owning a local login
          session supported by the optional runtime dependency <span class=
          "phrase"><a class="xref" href="../general/elogind.html" title=
          "elogind-255.5">elogind-255.5</a></span> , or the users in the
          <code class="systemitem">kvm</code> group to use the KVM device. As
          the <code class="systemitem">root</code> user, add any
          non-<code class="systemitem">root</code> users that might use the
          KVM device either without <span class="phrase"><a class="xref"
          href="../general/elogind.html" title=
          "elogind-255.5">elogind-255.5</a></span> installed or remotely (via
          a SSH connection) to the <code class="systemitem">kvm</code> group:
        </p>
        <pre class="root"><kbd class="command">usermod -a -G kvm <em class=
        "replaceable"><code>&lt;username&gt;</code></em></kbd></pre>
        <p>
          Install <span class="application">qemu</span> by running the
          following commands:
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Qemu is capable of running many targets. The build process is
            also capable of building multiple targets at one time in a comma
            delimited list assigned to <code class=
            "option">--target-list</code>. Run <span class=
            "command"><strong>./configure --help</strong></span> to get a
            complete list of available targets.
          </p>
        </div>
        <pre class="userinput"><kbd class=
        "command">if [ $(uname -m) = i686 ]; then
   QEMU_ARCH=i386-softmmu
else
   QEMU_ARCH=x86_64-softmmu
fi


mkdir -vp build &amp;&amp;
cd        build &amp;&amp;

../configure --prefix=/usr               \
             --sysconfdir=/etc           \
             --localstatedir=/var        \
             --target-list=$QEMU_ARCH    \
             --audio-drv-list=alsa       \
             --disable-pa                \
             --enable-slirp              \
             --docdir=/usr/share/doc/qemu-9.0.2 &amp;&amp;

unset QEMU_ARCH &amp;&amp;

make</kbd></pre>
        <p>
          <span class="application">qemu</span> uses <span class=
          "command"><strong>ninja</strong></span> as a subprocess when
          building. To run the tests, issue: <span class=
          "command"><strong>ninja test</strong></span>. One test,
          bios-tables-test, is known to fail.
        </p>
        <p>
          Now, as the <code class="systemitem">root</code> user:
        </p>
        <pre class="root"><kbd class="command">make install</kbd></pre>
        <p>
          Change the permissions and ownership of a helper script, which is
          needed when using the <span class="quote">“<span class=
          "quote">bridge</span>”</span> network device (see below). Again as
          the <code class="systemitem">root</code> user, issue:
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            You need to add any users who might use the <span class=
            "quote">“<span class="quote">bridge</span>”</span> network device
            into the <code class="systemitem">kvm</code> group even if
            <span class="phrase"><a class="xref" href=
            "../general/elogind.html" title=
            "elogind-255.5">elogind-255.5</a></span> is installed.
          </p>
        </div>
        <pre class="root"><kbd class=
        "command">chgrp kvm  /usr/libexec/qemu-bridge-helper &amp;&amp;
chmod 4750 /usr/libexec/qemu-bridge-helper</kbd></pre>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            For convenience you may want to create a symbolic link to run the
            installed program. For instance (as the <code class=
            "systemitem">root</code> user):
          </p>
          <pre class="root"><kbd class=
          "command">ln -sv qemu-system-`uname -m` /usr/bin/qemu</kbd></pre>
        </div>
      </div>
      <div class="commands" lang="en" xml:lang="en">
        <h2 class="sect2">
          Command Explanations
        </h2>
        <p>
          <em class="parameter"><code>--audio-drv-list=alsa</code></em>: This
          switch sets the audio driver to ALSA. See below for enabling other
          audio drivers.
        </p>
        <p>
          <em class="parameter"><code>--disable-pa</code></em>: even if
          <span class="emphasis"><em>pa</em></span> is not in <em class=
          "parameter"><code>--audio-drv-list</code></em> list, the pulseaudio
          driver is built, unless disabled by this parameter.
        </p>
        <p>
          <em class="parameter"><code>--enable-slirp</code></em>: This switch
          forces the building system to check for <a class="xref" href=
          "../basicnet/libslirp.html" title=
          "libslirp-4.8.0">libslirp-4.8.0</a>. Remove it if you don't need
          the <code class="option">-netdev user</code> support.
        </p>
        <p>
          <code class="option">--audio-drv-list=pa --disable-alsa</code>:
          This switch sets the audio driver to pulseaudio. For other drivers
          see the --audio-drv-list choices in the output of <span class=
          "command"><strong>./configure --help</strong></span>. The default
          audio driver is OSS. To enable support for both alsa and
          pulseaudio, use <code class=
          "option">--audio-drv-list=alsa,pa</code>.
        </p>
      </div>
      <div class="using" lang="en" xml:lang="en">
        <h2 class="sect2">
          Using Qemu
        </h2>
        <p>
          Since using qemu means using a virtual computer, the steps to set
          up the virtual machine are in close analogy with those to set up a
          real computer. You'll need to decide about CPU, memory, disk, USB
          devices, network card(s), screen size, etc. Once the <span class=
          "quote">“<span class="quote">hardware</span>”</span> is decided,
          you'll have for example to choose how to connect the machine to
          internet, and/or to install an OS. In the following, we show basic
          ways of performing those steps. But qemu is much more than this,
          and it is strongly advised to read the qemu documentation in
          <code class=
          "filename">/usr/share/doc/qemu-9.0.2/qemu-doc.html</code>.
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            It is standard practice to name the computer running qemu
            <span class="quote">“<span class="quote">host</span>”</span> and
            the emulated machine running under qemu the <span class=
            "quote">“<span class="quote">guest.</span>”</span> We'll use
            those notations in the following.
          </p>
        </div>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            The following instructions assume the optional symbolic link,
            <code class="filename">qemu</code>, has been created.
            Additionally, <span class="command"><strong>qemu</strong></span>
            should be run in a graphical environment. But it is possible to
            use qemu <span class="quote">“<span class=
            "quote">headless</span>”</span> or through SSH. See the
            documentation for the various possibilities.
          </p>
        </div>
        <h3>
          Disk
        </h3>
        <p>
          A virtual disk may be set up in the following way:
        </p>
        <pre class="userinput"><kbd class="command">VDISK_SIZE=<em class=
        "replaceable"><code>50G</code></em>
VDISK_FILENAME=<em class="replaceable"><code>vdisk.img</code></em>
qemu-img create -f qcow2 $VDISK_FILENAME $VDISK_SIZE</kbd></pre>
        <p>
          The virtual disk size and filename should be adjusted as desired.
          The actual size of the file will be less than specified, but will
          expand as needed, so it is safe to put a high value.
        </p>
        <h3>
          Operating System
        </h3>
        <p>
          To install an operating system, download an iso image from your
          preferred Linux distribution. For the purposes of this example,
          we'll use <code class=
          "filename">Fedora-16-x86_64-Live-LXDE.iso</code> in the current
          directory. Run the following:
        </p>
        <pre class="userinput"><kbd class=
        "command">qemu -enable-kvm                           \
     -drive file=$VDISK_FILENAME           \
     -cdrom Fedora-16-x86_64-Live-LXDE.iso \
     -boot d                               \
     -m <em class="replaceable"><code>1G</code></em></kbd></pre>
        <p>
          Follow the normal installation procedures for the chosen
          distribution. The <em class="parameter"><code>-boot</code></em>
          option specifies the boot order of drives as a string of drive
          letters. Valid drive letters are: a, b (floppy 1 and 2), c (first
          hard disk), d (first CD-ROM). The <em class=
          "parameter"><code>-m</code></em> option is the amount of memory to
          use for the virtual machine. The choice depends on the load of the
          host. Modern distributions should be comfortable with 1GB. The
          <em class="parameter"><code>-enable-kvm</code></em> option allows
          hardware acceleration. Without this switch, the emulation is much
          slower.
        </p>
        <h3>
          Defining the virtual hardware
        </h3>
        <p>
          The virtual machine hardware is defined by the qemu command line.
          An example command is given below:
        </p>
        <pre class="userinput"><kbd class=
        "command">qemu -enable-kvm                     \
     -smp 4                          \
     -cpu host                       \
     -m 1G                           \
     -drive file=$VDISK_FILENAME     \
     -cdrom grub-img.iso             \
     -boot order=c,once=d,menu=on    \
     -net nic,netdev=net0            \
     -netdev user,id=net0            \
     -device ac97                    \
     -vga std                        \
     -serial mon:stdio               \
     -name "fedora-16"</kbd></pre>
        <h3>
          Meaning of the command line options
        </h3>
        <p>
          <em class="parameter"><code>-enable-kvm</code></em>: enable full
          KVM virtualization support. On some hardware, it may be necessary
          to add the undocumented <code class="option">-machine
          smm=off</code> option in order to enable KVM.
        </p>
        <p>
          <em class="parameter"><code>-smp &lt;N&gt;</code></em>: enable
          symmetric multiprocessing with &lt;N&gt; CPUs.
        </p>
        <p>
          <em class="parameter"><code>-cpu &lt;model&gt;</code></em>:
          simulate CPU &lt;model&gt;. the list of supported models can be
          obtained with <code class="option">-cpu help</code>.
        </p>
        <p>
          <em class="parameter"><code>-drive
          file=&lt;filename&gt;</code></em>: defines a virtual disk whose
          image is stored in <code class="filename">&lt;filename&gt;</code>.
        </p>
        <p>
          <em class="parameter"><code>-cdrom grub-img.iso</code></em>:
          defines an iso formatted file to use as a cdrom. Here we use a grub
          rescue disk, which may turn handy when something goes wrong at boot
          time.
        </p>
        <p>
          <em class="parameter"><code>-boot
          order=c,once=d,menu=on</code></em>: defines the boot order for the
          virtual BIOS.
        </p>
        <p>
          <em class="parameter"><code>-net
          nic,netdev=&lt;netid&gt;</code></em>: defines a network card
          connected to the network device with id &lt;netid&gt;.
        </p>
        <p>
          <em class="parameter"><code>-netdev
          user,id=&lt;netid&gt;</code></em>: defines the network <span class=
          "quote">“<span class="quote">user</span>”</span> device. This is a
          virtual local network with addresses 10.0.2.0/24, where the host
          has address 10.0.2.2 and acts as a gateway to internet, and with a
          name server at address 10.0.2.3, and an smb server at address
          10.0.2.4. A builtin DHCP server can allocate addresses between
          10.0.2.15 and 10.0.2.31.
        </p>
        <p>
          <em class="parameter"><code>-soundhw &lt;model&gt;</code></em>:
          defines the soundcard model. The list may be obtained with
          <code class="option">-soundhw help</code>.
        </p>
        <p>
          <em class="parameter"><code>-vga &lt;type&gt;</code></em>: defines
          the type of VGA card to emulate. For <em class=
          "parameter"><code>-vga std</code></em>, if you are building a Linux
          kernel for the guest, it's recommended to enable <code class=
          "option">CONFIG_DRM_BOCHS</code> (as a part of the kernel or a
          kernel module) to drive all the features of the emulated VGA card,
          and <code class="option">CONFIG_FB</code> to display the Linux
          console on it. The other <code class="option">&lt;type&gt;</code>
          values are not tested by the editors and may require additional
          dependencies.
        </p>
        <p>
          <em class="parameter"><code>-serial mon:stdio</code></em>: sends
          the serial port of the guest (<code class=
          "filename">/dev/ttyS0</code> on linux guests), multiplexed with the
          qemu monitor, to the standard input and output of the qemu process.
        </p>
        <p>
          <em class="parameter"><code>-name &lt;name&gt;</code></em>: sets
          the name of the guest. This name is displayed in the guest window
          caption. It may be useful if you run several guests at the same
          time.
        </p>
        <p>
          <code class="option">-drive
          if=pflash,format=raw,readonly=on,file=/usr/share/qemu/edk2-x86_64-code.fd</code>:
          Load a pre-built EDK2 UEFI firmware, instead of the default PC
          BIOS. Use this option if you want to boot the guest OS with UEFI.
        </p>
        <p>
          <code class="option">-drive file=&lt;filename&gt;,if=virtio</code>:
          Provide Virtio interface to the guest kernel for accessing the disk
          image, instead of simulating a real disk hardware. This can improve
          disk I/O performance, but it requires a Virtio driver in guest
          kernel. Use it instead of a plain <code class=
          "option">-drive</code> if the guest kernel supports Virtio. To
          build a Linux kernel with Virtio support for the guest, use
          <span class="command"><strong>make defconfig &amp;&amp; make
          kvm_guest.config</strong></span> to create an initial kernel
          configuration with the Virtio drives enabled, then make your
          customization. And, if the guest kernel is Linux, the virtual disks
          using Virtio interface will be named <code class=
          "filename">vdx</code> in the devtmpfs, instead of <code class=
          "filename">sdx</code>.
        </p>
        <p>
          <code class="option">-net
          nic,netdev=net0,model=virtio-net-pci</code>: Provide Virtio
          interface to the guest kernel for accessing the network interface,
          instead of simulating a real network interface card. This can
          improve network I/O performance, but it requires a Virtio driver in
          guest kernel. Use it instead of a plain <code class=
          "option">-net</code> if the guest kernel supports Virtio.
        </p>
        <h3>
          Controlling the Emulated Display
        </h3>
        <p>
          To set the resolution of the emulated display for a Xorg server
          running in the guest Linux system, read <a class="xref" href=
          "../x/xorg-config.html#xdisplay" title=
          "Fine Tuning Display Settings">the section called “Fine Tuning
          Display Settings”</a>.
        </p>
        <h3>
          Networking
        </h3>
        <p>
          The above solution for networking allows the guest to access the
          local network through the host (and possibly to access internet
          through the local routers), but the converse is not true. Not even
          the host can access the guest, unless port forwarding is enabled.
          And in the case several guests are running, they cannot communicate
          with each other. Other network devices can be used for this
          purpose. For example, there is the <span class=
          "quote">“<span class="quote">socket</span>”</span> device, which
          allows several guests to share a common virtual network. In the
          following, we describe in more details how to set up the
          <span class="quote">“<span class="quote">bridge</span>”</span>
          device, which allows the guests to appear as if connected to the
          local network. All the commands below should be run as the
          <code class="systemitem">root</code> user.
        </p>
        <p>
          Set up bridging with <a class="xref" href=
          "../basicnet/bridge-utils.html" title=
          "bridge-utils-1.7.1">bridge-utils-1.7.1</a>. Only the physical
          interface(s) should be set up at boot. The virtual interface(s)
          will be added as needed when qemu is started.
        </p>
        <p>
          Set up a required configuration file:
        </p>
        <pre class="root"><kbd class=
        "command">install -vdm 755 /etc/qemu &amp;&amp;
echo allow br0 &gt; /etc/qemu/bridge.conf</kbd></pre>
        <p>
          In the qemu command line above, replace the switch <em class=
          "parameter"><code>-netdev user,...</code></em> with <em class=
          "parameter"><code>-netdev bridge,...</code></em>.
        </p>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <h2 class="sect2">
          Contents
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Installed Programs:</strong>
              <span class="segbody">elf2dmp, qemu (symlink), qemu-edid,
              qemu-ga, qemu-img, qemu-io, qemu-keymap, qemu-nbd,
              qemu-pr-helper, qemu-storage-daemon, and
              qemu-system-&lt;arch&gt;</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Library:</strong>
              <span class="segbody">None</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Directories:</strong>
              <span class="segbody">/usr/share/qemu and
              /usr/share/doc/qemu-9.0.2 (optional)</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Short Description
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="elf2dmp" name="elf2dmp"></a><span class=
                    "term"><span class=
                    "command"><strong>elf2dmp</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    Converts files from elf to dmp format
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-edid" name="qemu-edid"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-edid</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a test tool for the qemu EDID generator
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-ga" name="qemu-ga"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-ga</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    implements support for QMP (QEMU Monitor Protocol)
                    commands and events that terminate and originate
                    respectively within the guest using an agent built as
                    part of QEMU
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-img" name="qemu-img"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-img</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    provides commands to manage QEMU disk images
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-io" name="qemu-io"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-io</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a diagnostic and manipulation program for (virtual)
                    memory media. It is still at an early stage of
                    development
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-keymap" name="qemu-keymap"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-keymap</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    generates qemu reverse keymaps from xkb keymaps, which
                    can be used with the qemu "-k" command line switch
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-nbd" name="qemu-nbd"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-nbd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    exports Qemu disk images using the QEMU Disk Network
                    Block Device (NBD) protocol
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-pr-helper" name=
                    "qemu-pr-helper"></a><span class="term"><span class=
                    "command"><strong>qemu-pr-helper</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    Implements the persistent reservation helper for QEMU
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-storage-daemon" name=
                    "qemu-storage-daemon"></a><span class="term"><span class=
                    "command"><strong>qemu-storage-daemon</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    allows to modify disk images using the QEMU Monitor
                    Protocol (QMP) without running a VM
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="qemu-system" name="qemu-system"></a><span class=
                    "term"><span class=
                    "command"><strong>qemu-system-x86_64</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is the QEMU PC System emulator
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="virtualization.html" title=
          "Virtualization">Prev</a>
          <p>
            Virtualization
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../general/general.html" title=
          "General Libraries and Utilities">Next</a>
          <p>
            General Libraries and Utilities
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="virtualization.html" title=
          "Chapter&nbsp;8.&nbsp;Virtualization">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.2">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
