<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      GRUB-2.12 for EFI
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-12.2">
    <div class="navheader">
      <h4>
        Beyond Linux<sup>®</sup> From Scratch <span class="phrase">(System
        V</span> Edition) - Version 12.2
      </h4>
      <h3>
        Chapter&nbsp;5.&nbsp;File Systems and Disk Management
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="efibootmgr.html" title=
          "efibootmgr-18">Prev</a>
          <p>
            efibootmgr-18
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="grub-setup.html" title=
          "Using GRUB to Set Up the Boot Process with UEFI">Next</a>
          <p>
            Using GRUB to Set Up the Boot Process with UEFI
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapter&nbsp;5.&nbsp;File Systems and Disk Management">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.2">Home</a>
        </li>
      </ul>
    </div>
    <h1 class="sect1">
      <a id="grub-efi" name="grub-efi"></a>GRUB-2.12 for EFI
    </h1>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="package" lang="en" xml:lang="en">
        <h2 class="sect2">
          Introduction to GRUB
        </h2>
        <p>
          The <span class="application">GRUB</span> package provides GRand
          Unified Bootloader. In this page it will be built with UEFI
          support, which is not enabled for GRUB built in LFS.
        </p>
        <p>
          This package is known to build and work properly using an LFS 12.2
          platform.
        </p>
        <h3>
          Package Information
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Download (HTTP): <a class="ulink" href=
                "https://ftp.gnu.org/gnu/grub/grub-2.12.tar.xz">https://ftp.gnu.org/gnu/grub/grub-2.12.tar.xz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Download MD5 sum: 60c564b1bdc39d8e43b3aab4bc0fb140
              </p>
            </li>
            <li class="listitem">
              <p>
                Download size: 6.4 MB
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated disk space required: 183 MB
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated build time: 0.4 SBU (on 64-bit LFS, using
                parallelism=4)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Additional Downloads
        </h3>
        <div class="itemizedlist">
          <p class="title">
            <strong>Unicode font data used to display GRUB menu</strong>
          </p>
          <ul class="compact">
            <li class="listitem">
              <p>
                Download (HTTP): <a class="ulink" href=
                "https://unifoundry.com/pub/unifont/unifont-15.1.05/font-builds/unifont-15.1.05.pcf.gz">
                https://unifoundry.com/pub/unifont/unifont-15.1.05/font-builds/unifont-15.1.05.pcf.gz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Download MD5 sum: da47e9c7a2cec3b68a0fad5d2a341dcc
              </p>
            </li>
            <li class="listitem">
              <p>
                Download size: 1.4 MB
              </p>
            </li>
          </ul>
        </div>
        <div class="itemizedlist">
          <p class="title">
            <strong>GCC (only needed if building on 32-bit LFS)</strong>
          </p>
          <ul class="compact">
            <li class="listitem">
              <p>
                Refer to <a class="xref" href="../general/gcc.html" title=
                "GCC-14.2.0">GCC-14.2.0</a> page for download info.
              </p>
            </li>
          </ul>
        </div>
        <h3>
          GRUB Dependencies
        </h3>
        <h4>
          Recommended
        </h4>
        <p class="recommended">
          <a class="xref" href="efibootmgr.html" title=
          "efibootmgr-18">efibootmgr-18</a> (runtime) and <a class="xref"
          href="../general/freetype2.html" title=
          "FreeType-2.13.3">FreeType-2.13.3</a>
        </p>
        <h4>
          Optional
        </h4>
        <p class="optional">
          <a class="xref" href="lvm2.html" title=
          "LVM2-2.03.26">LVM2-2.03.26</a> and <a class="xref" href=
          "fuse.html" title="Fuse-3.16.2">Fuse-3.16.2</a>
        </p>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <h2 class="sect2">
          Installation of GRUB
        </h2>
        <p>
          First, install font data as the <code class=
          "systemitem">root</code> user:
        </p>
        <pre class="root"><kbd class=
        "command">mkdir -pv /usr/share/fonts/unifont &amp;&amp;
gunzip -c ../unifont-15.1.05.pcf.gz &gt; /usr/share/fonts/unifont/unifont.pcf</kbd></pre>
        <div class="admon warning">
          <img alt="[Warning]" src="../images/warning.png" />
          <h3>
            Warning
          </h3>
          <p>
            Unset any environment variables which may affect the build:
          </p>
          <pre class="userinput"><kbd class=
          "command">unset {C,CPP,CXX,LD}FLAGS</kbd></pre>
          <p>
            Don't try <span class="quote">“<span class=
            "quote">tuning</span>”</span> this package with custom
            compilation flags: this package is a bootloader, with low-level
            operations in the source code which is likely to be broken by
            some aggressive optimizations.
          </p>
        </div>
        <p>
          Add a file missing from the release tarball:
        </p>
        <pre class="userinput"><kbd class="command">echo <code class=
        "literal">depends bli part_gpt</code> &gt; grub-core/extra_deps.lst</kbd></pre>
        <p>
          If you are running a 32-bit LFS, prepare a 64-bit compiler:
        </p>
        <pre class="userinput"><kbd class=
        "command">case $(uname -m) in i?86 )
    <code class="literal">tar xf ../gcc-14.2.0.tar.xz
    mkdir gcc-14.2.0/build
    pushd gcc-14.2.0/build
        ../configure --prefix=$PWD/../../x86_64-gcc \
                     --target=x86_64-linux-gnu      \
                     --with-system-zlib             \
                     --enable-languages=c,c++       \
                     --with-ld=/usr/bin/ld
        make all-gcc
        make install-gcc
    popd
    export TARGET_CC=$PWD/x86_64-gcc/bin/x86_64-linux-gnu-gcc</code>
esac</kbd></pre>
        <p>
          Build <span class="application">GRUB</span> with the following
          commands:
        </p>
        <pre class="userinput"><kbd class=
        "command">./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --disable-efiemu     \
            --enable-grub-mkfont \
            --with-platform=efi  \
            --target=x86_64      \
            --disable-werror     &amp;&amp;
unset TARGET_CC &amp;&amp;
make</kbd></pre>
        <p>
          This package does not have a test suite providing meaningful
          results.
        </p>
        <p>
          Now, if you've skip the LFS GRUB package, as the <code class=
          "systemitem">root</code> user:
        </p>
        <pre class="userinput"><kbd class="command">make install &amp;&amp;
mv -v /etc/bash_completion.d/grub /usr/share/bash-completion/completions</kbd></pre>
        <p>
          If you've not skip LFS GRUB package, as the <code class=
          "systemitem">root</code> user, only install the components not
          installed from the LFS GRUB package instead:
        </p>
        <pre class="root"><kbd class="command">make DESTDIR=$PWD/dest install
cp -av dest/usr/lib/grub/x86_64-efi -T /usr/lib/grub/x86_64-efi
cp -av dest/usr/share/grub/*.{pf2,h}   /usr/share/grub
cp -av dest/usr/bin/grub-mkfont        /usr/bin</kbd></pre>
        <p>
          If the optional dependencies are installed, also install the
          <span class="command"><strong>grub-mount</strong></span> program:
        </p>
        <pre class="userinput"><kbd class=
        "command">cp -av dest/usr/bin/grub-mount /usr/bin</kbd></pre>
      </div>
      <div class="commands" lang="en" xml:lang="en">
        <h2 class="sect2">
          Command Explanations
        </h2>
        <p>
          <em class="parameter"><code>--enable-grub-mkfont</code></em>: Build
          the tool named <span class=
          "command"><strong>grub-mkfont</strong></span> to generate the font
          file for the boot loader from the font data we've installed.
        </p>
        <div class="admon warning">
          <img alt="[Warning]" src="../images/warning.png" />
          <h3>
            Warning
          </h3>
          <p>
            If the recommended dependency <a class="xref" href=
            "../general/freetype2.html" title=
            "FreeType-2.13.3">FreeType-2.13.3</a> is not installed, it is
            possible to omit this option and build GRUB. However, if
            <span class="command"><strong>grub-mkfont</strong></span> is not
            built, or the unicode font data is not available at the time GRUB
            is built, GRUB won't install any font for the boot loader. The
            GRUB boot menu will be displayed using a coarse font or in a
            smaller region on the screen.
          </p>
        </div>
        <p>
          <em class="parameter"><code>--with-platform=efi</code></em>:
          Ensures building GRUB with EFI enabled.
        </p>
        <p>
          <em class="parameter"><code>--target=x86_64</code></em>: Ensures
          building GRUB for x86_64 even if building on a 32-bit LFS system.
          Most EFI firmware on x86_64 does not support 32-bit bootloaders.
        </p>
        <p>
          <code class="option">--target=i386</code>: A few 32-bit x86
          platforms have EFI support. And, some x86_64 platforms have a
          32-bit EFI implementation, but they are very old and rare. Use this
          instead of <em class="parameter"><code>--target=x86_64</code></em>
          if you are <span class="bold"><strong>absolutely
          sure</strong></span> that LFS is running on such a system.
        </p>
      </div>
      <div class="sect2" lang="en" xml:lang="en">
        <h2 class="sect2">
          Configuring GRUB
        </h2>
        <p>
          Using GRUB to make the LFS system bootable on UEFI platform will be
          discussed in <a class="xref" href="grub-setup.html" title=
          "Using GRUB to Set Up the Boot Process with UEFI">Using GRUB to Set
          Up the Boot Process with UEFI</a>.
        </p>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <h2 class="sect2">
          Contents
        </h2>
        <p>
          A list of the installed files, along with their short descriptions
          can be found at <a class="ulink" href=
          "../../../../lfs/view/12.2/chapter08/grub.html#contents-gRUB">../../../../lfs/view/12.2/chapter08/grub.html#contents-gRUB</a>.
        </p>
        <p>
          Listed below are the newly installed programs along with short
          descriptions.
        </p>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Installed Programs:</strong>
              <span class="segbody">grub-mkfont and grub-mount
              (optional)</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Directories:</strong>
              <span class="segbody">/usr/lib/grub/x86_64-efi</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Short Descriptions
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="grub-mkfont" name="grub-mkfont"></a><span class=
                    "term"><span class=
                    "command"><strong>grub-mkfont</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    converts common font file formats into PF2
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="grub-mount" name="grub-mount"></a><span class=
                    "term"><span class=
                    "command"><strong>grub-mount</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a debug tool for filesystem driver
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="efibootmgr.html" title=
          "efibootmgr-18">Prev</a>
          <p>
            efibootmgr-18
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="grub-setup.html" title=
          "Using GRUB to Set Up the Boot Process with UEFI">Next</a>
          <p>
            Using GRUB to Set Up the Boot Process with UEFI
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapter&nbsp;5.&nbsp;File Systems and Disk Management">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.2">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
