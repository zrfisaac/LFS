<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      btrfs-progs-6.10.1
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL-NS Stylesheets Vsnapshot" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-12.2">
    <div class="navheader">
      <h4>
        Beyond Linux<sup>®</sup> From Scratch <span class="phrase">(System
        V</span> Edition) - Version 12.2
      </h4>
      <h3>
        Chapter&nbsp;5.&nbsp;File Systems and Disk Management
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="initramfs.html" title=
          "About initramfs">Prev</a>
          <p>
            About initramfs
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="dosfstools.html" title=
          "dosfstools-4.2">Next</a>
          <p>
            dosfstools-4.2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapter&nbsp;5.&nbsp;File Systems and Disk Management">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.2">Home</a>
        </li>
      </ul>
    </div>
    <h1 class="sect1">
      <a id="btrfs-progs" name="btrfs-progs"></a>btrfs-progs-6.10.1
    </h1>
    <div class="sect1" lang="en" xml:lang="en">
      <div class="package" lang="en" xml:lang="en">
        <h2 class="sect2">
          Introduction to btrfs-progs
        </h2>
        <p>
          The <span class="application">btrfs-progs</span> package contains
          administration and debugging tools for the B-tree file system
          (btrfs).
        </p>
        <p>
          This package is known to build and work properly using an LFS 12.2
          platform.
        </p>
        <h3>
          Package Information
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li class="listitem">
              <p>
                Download (HTTP): <a class="ulink" href=
                "https://www.kernel.org/pub/linux/kernel/people/kdave/btrfs-progs/btrfs-progs-v6.10.1.tar.xz">
                https://www.kernel.org/pub/linux/kernel/people/kdave/btrfs-progs/btrfs-progs-v6.10.1.tar.xz</a>
              </p>
            </li>
            <li class="listitem">
              <p>
                Download MD5 sum: a72e76a634ad70dd183153bb99034e4c
              </p>
            </li>
            <li class="listitem">
              <p>
                Download size: 2.5 MB
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated disk space required: 65 MB (transient files created
                during tests need up to 10 GB)
              </p>
            </li>
            <li class="listitem">
              <p>
                Estimated build time: 0.3 SBU (with parallelism=4; add 4.0
                SBU for tests, up to 14 SBU on slow disks)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Btrfs-progs Dependencies
        </h3>
        <h4>
          Required
        </h4>
        <p class="required">
          <a class="xref" href="../general/lzo.html" title=
          "LZO-2.10">LZO-2.10</a>
        </p>
        <h4>
          Optional
        </h4>
        <p class="optional">
          <a class="xref" href="lvm2.html" title=
          "LVM2-2.03.26">LVM2-2.03.26</a> (<span class=
          "command"><strong>dmsetup</strong></span> is used in tests),
          <a class="xref" href="../general/python-modules.html#sphinx" title=
          "Sphinx-8.0.2">sphinx-8.0.2</a> and <a class="xref" href=
          "../general/python-modules.html#sphinx_rtd_theme" title=
          "Sphinx_rtd_theme-2.0.0">sphinx_rtd_theme-2.0.0</a> (required to
          build documentation), and <a class="ulink" href=
          "https://mirrors.edge.kernel.org/pub/linux/kernel/people/jeffm/reiserfsprogs/">
          reiserfsprogs</a> (for tests).
        </p>
      </div>
      <div class="kernel" lang="en" xml:lang="en">
        <h2 class="sect2">
          <a id="btrfs-progs-kernel" name="btrfs-progs-kernel"></a>Kernel
          Configuration
        </h2>
        <p>
          Enable the following option in the kernel configuration and
          recompile the kernel:
        </p>
        <pre class="screen"><span class="blue">F</span>ile systems ---&gt;
  &lt;*/M&gt; <span class=
"blue">B</span>trfs filesystem support                                      [BTRFS_FS]</pre>
        <p>
          In addition to the above and to the options required for <a class=
          "xref" href="lvm2.html" title="LVM2-2.03.26">LVM2-2.03.26</a>, the
          following options must be set for running tests. The options marked
          as empty should <span class="emphasis"><em>not</em></span> be
          selected because they are for developers and make some tests fail.
        </p>
        <pre class="screen"><span class="blue">F</span>ile systems ---&gt;
  &lt;*/M&gt; <span class=
"blue">B</span>trfs filesystem support                                      [BTRFS_FS]
  [*]     <span class=
"blue">B</span>trfs POSIX Access Control Lists                  [BTRFS_FS_POSIX_ACL]
  [ ]     <span class=
"blue">B</span>trfs will run sanity tests upon loading   [BTRFS_FS_RUN_SANITY_TESTS]
  [ ]     <span class=
"blue">B</span>trfs debugging support                                  [BTRFS_DEBUG]
  [ ]     <span class=
"blue">B</span>trfs assert support                                    [BTRFS_ASSERT]
  [ ]     <span class=
"blue">B</span>trfs with the ref verify tool compiled in       [BTRFS_FS_REF_VERIFY]</pre>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <h2 class="sect2">
          Installation of btrfs-progs
        </h2>
        <p>
          Install <span class="application">btrfs-progs</span> by running the
          following commands:
        </p>
        <pre class="userinput"><kbd class=
        "command">./configure --prefix=/usr           \
            --disable-static        \
            --disable-documentation &amp;&amp;
make</kbd></pre>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            Some tests require grep built with perl regular expressions. To
            obtain this, rebuild grep with the LFS Chapter 8 instructions
            after installing <a class="xref" href="../general/pcre2.html"
            title="PCRE2-10.44">pcre2-10.44</a>.
          </p>
        </div>
        <p>
          Before running tests, build a support program:
        </p>
        <pre class="userinput"><kbd class="command">make fssum</kbd></pre>
        <p>
          To test the results, issue (as the <code class=
          "systemitem">root</code> user):
        </p>
        <pre class="root"><kbd class="command">pushd tests
   ./fsck-tests.sh
   ./mkfs-tests.sh
   ./cli-tests.sh
   ./convert-tests.sh
   ./misc-tests.sh
   ./fuzz-tests.sh
popd</kbd></pre>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            If the above mentioned kernel options are not enabled, some tests
            fail, and prevent all the remaining tests from running because
            the test disk image is not cleanly unmounted. Also make sure that
            the btrfs kernel module is loaded.
          </p>
        </div>
        <p>
          Install the package as the <code class="systemitem">root</code>
          user:
        </p>
        <pre class="root"><kbd class="command">make install</kbd></pre>
        <p>
          If you have passed <em class=
          "parameter"><code>--disable-documentation</code></em> to
          <span class="command"><strong>configure</strong></span> and you
          need the manual pages, install them by running, as the <code class=
          "systemitem">root</code> user:
        </p>
        <pre class="root"><kbd class="command">for i in 5 8; do
   install Documentation/*.$i /usr/share/man/man$i
done</kbd></pre>
      </div>
      <div class="commands" lang="en" xml:lang="en">
        <h2 class="sect2">
          Command Explanations
        </h2>
        <p>
          <em class="parameter"><code>--disable-static</code></em>: This
          switch prevents installation of static versions of the libraries.
        </p>
        <p>
          <em class="parameter"><code>--disable-documentation</code></em>:
          This switch disables rebuilding the manual pages, because it
          requires <a class="xref" href=
          "../general/python-modules.html#sphinx" title=
          "Sphinx-8.0.2">sphinx-8.0.2</a>.
        </p>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <h2 class="sect2">
          Contents
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Installed Programs:</strong>
              <span class="segbody">btrfs, btrfs-convert, btrfs-find-root,
              btrfs-image, btrfs-map-logical, btrfs-select-super, btrfsck
              (link to btrfs), btrfstune, fsck.btrfs, and mkfs.btrfs</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Libraries:</strong>
              <span class="segbody">libbtrfs.so and libbtrfsutil.so</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Directories:</strong>
              <span class="segbody">/usr/include/btrfs</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Short Descriptions
          </h3>
          <table border="0" class="variablelist">
            <colgroup>
              <col align="left" valign="top" />
              <col />
            </colgroup>
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="btrfs-prog" name="btrfs-prog"></a><span class=
                    "term"><span class=
                    "command"><strong>btrfs</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is the main interface into btrfs filesystem operations
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="btrfs-convert" name=
                    "btrfs-convert"></a><span class="term"><span class=
                    "command"><strong>btrfs-convert</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    converts from an ext2/3/4 or reiserfs filesystem to btrfs
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="btrfs-find-root" name=
                    "btrfs-find-root"></a><span class="term"><span class=
                    "command"><strong>btrfs-find-root</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a filter to find btrfs root
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="btrfs-map-logical" name=
                    "btrfs-map-logical"></a><span class="term"><span class=
                    "command"><strong>btrfs-map-logical</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    maps btrfs logical extent to physical extent
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="btrfs-select-super" name=
                    "btrfs-select-super"></a><span class="term"><span class=
                    "command"><strong>btrfs-select-super</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    overwrites the primary superblock with a backup copy
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="btrfstune" name="btrfstune"></a><span class=
                    "term"><span class=
                    "command"><strong>btrfstune</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    tunes various filesystem parameters
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="fsck.btrfs" name="fsck.btrfs"></a><span class=
                    "term"><span class=
                    "command"><strong>fsck.btrfs</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    does nothing, but is present for consistency with fstab
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="mkfs.btrfs" name="mkfs.btrfs"></a><span class=
                    "term"><span class=
                    "command"><strong>mkfs.btrfs</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    creates a btrfs file system
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="initramfs.html" title=
          "About initramfs">Prev</a>
          <p>
            About initramfs
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="dosfstools.html" title=
          "dosfstools-4.2">Next</a>
          <p>
            dosfstools-4.2
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="filesystems.html" title=
          "Chapter&nbsp;5.&nbsp;File Systems and Disk Management">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch    (System V Edition) - Version 12.2">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
